<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>blog</title>
    <meta name="description" content="Vuepress blog demo">
    
    
    <link rel="preload" href="/assets/css/0.styles.e12d9437.css" as="style"><link rel="preload" href="/assets/js/app.702528d9.js" as="script"><link rel="preload" href="/assets/js/2.bc0a9366.js" as="script"><link rel="preload" href="/assets/js/8.68952ef1.js" as="script"><link rel="prefetch" href="/assets/js/10.189532b9.js"><link rel="prefetch" href="/assets/js/11.40dc7aad.js"><link rel="prefetch" href="/assets/js/12.4155dd95.js"><link rel="prefetch" href="/assets/js/13.8a25e8dd.js"><link rel="prefetch" href="/assets/js/14.742193af.js"><link rel="prefetch" href="/assets/js/15.eb8951e8.js"><link rel="prefetch" href="/assets/js/16.300d77c3.js"><link rel="prefetch" href="/assets/js/17.f9e887bb.js"><link rel="prefetch" href="/assets/js/18.72e5452b.js"><link rel="prefetch" href="/assets/js/19.8eac0218.js"><link rel="prefetch" href="/assets/js/20.698aa3d9.js"><link rel="prefetch" href="/assets/js/21.df54a1e3.js"><link rel="prefetch" href="/assets/js/22.202bc424.js"><link rel="prefetch" href="/assets/js/23.dcdfe1c2.js"><link rel="prefetch" href="/assets/js/24.e5dfe154.js"><link rel="prefetch" href="/assets/js/3.819e11ff.js"><link rel="prefetch" href="/assets/js/4.b2f530cc.js"><link rel="prefetch" href="/assets/js/5.e6bf6ba4.js"><link rel="prefetch" href="/assets/js/6.ddcd92ff.js"><link rel="prefetch" href="/assets/js/7.d7bcaf4d.js"><link rel="prefetch" href="/assets/js/9.17a8032f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e12d9437.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/FirstBlog.html" class="nav-link">FirstBlog</a></div><div class="nav-item"><a href="/blog/Resume.html" class="nav-link">轻松面试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">MySql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/索引.html" class="nav-link">索引</a></li><li class="dropdown-item"><!----> <a href="/mysql/锁.html" class="nav-link">锁</a></li><li class="dropdown-item"><!----> <a href="/mysql/事务.html" class="nav-link">事务</a></li><li class="dropdown-item"><!----> <a href="/mysql/优化.html" class="nav-link">优化</a></li><li class="dropdown-item"><!----> <a href="/mysql/基础SQL语句.html" class="nav-link">基础SQL语句</a></li><li class="dropdown-item"><!----> <a href="/blog/.html" class="nav-link"></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Spring.html" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">缓存</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Redis.html" class="nav-link">Redis</a></li></ul></div></div> <a href="https://github.com/EternalHao" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/FirstBlog.html" class="nav-link">FirstBlog</a></div><div class="nav-item"><a href="/blog/Resume.html" class="nav-link">轻松面试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">MySql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/索引.html" class="nav-link">索引</a></li><li class="dropdown-item"><!----> <a href="/mysql/锁.html" class="nav-link">锁</a></li><li class="dropdown-item"><!----> <a href="/mysql/事务.html" class="nav-link">事务</a></li><li class="dropdown-item"><!----> <a href="/mysql/优化.html" class="nav-link">优化</a></li><li class="dropdown-item"><!----> <a href="/mysql/基础SQL语句.html" class="nav-link">基础SQL语句</a></li><li class="dropdown-item"><!----> <a href="/blog/.html" class="nav-link"></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Spring.html" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">缓存</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Redis.html" class="nav-link">Redis</a></li></ul></div></div> <a href="https://github.com/EternalHao" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>这块也是被问烂的</p></blockquote> <h3 id="hashmapd"><a href="#hashmapd" class="header-anchor">#</a> HashMapd</h3> <blockquote><p>HashMap 可以说是博大精深,必须熟练度加加加,通常位置也是集中在这两块,扩容方面和线程安全问题</p></blockquote> <blockquote><ol><li>介绍HashMap
HashMap通常会用一个指针数组（假设为table[]）来做分散所有的key，当一个key被加入时，会通过Hash算法通过key算出这个数组的下标i，然后就把这个&lt;key, value&gt;插到table[i]中，如果有两个不同的key被算在了同一个i，那么就叫冲突，又叫碰撞，这样会在table[i]上形成一个链表</li></ol></blockquote> <p>所以，Hash表的尺寸和容量非常的重要。一般来说，Hash表这个容器当有数据要插入时，都会检查容量有没有超过设定的thredhold，如果超过，需要增大Hash表的尺寸，但是这样一来，整个Hash表里的无素都需要被重算一遍。这叫rehash，这个成本相当的大</p> <p>1.7 数组 + 链表
1.8 数组 + 链表 + 红黑树</p> <p>链表 长度 &gt;=  8
为什么是 8</p> <blockquote><ol start="2"><li>存在的问题
1.7
![酷克]](https://coolshell.cn/articles/9606.html)
形成环的过程痛苦
1.8</li></ol></blockquote> <blockquote><ol start="3"><li>如何解决
1.7</li></ol></blockquote> <p>1.8</p> <blockquote><p>线程安全问题
个人觉得 HashMap 在并发时可能出现的问题主要是两方面,首先如果多个线程同时使用put方法添加元素，而且假设正好存在两个 put 的 key 发生了碰撞(根据 hash 值计算的 bucket 一样)，那么根据 HashMap 的实现，这两个 key 会添加到数组的同一个位置，这样最终就会发生其中一个线程的 put 的数据被覆盖。第二就是如果多个线程同时检测到元素个数超过数组大小* loadFactor ，这样就会发生多个线程同时对 Node 数组进行扩容，都在重新计算元素位置以及复制数据，但是最终只有一个线程扩容后的数组会赋给 table，也就是说其他线程的都会丢失，并且各自线程 put 的数据也丢失。</p></blockquote> <p>当多个线程同时检测到总数量超过门限值的时候就会同时调用resize操作，各自生成新的数组并rehash后赋给该map底层的数组table，结果最终只有最后一个线程生成的新数组被赋给table变量，其他线程的均会丢失。而且当某些线程已经完成赋值而其他线程刚开始的时候，就会用已经被赋值的table作为原始数组，这样也会有问题。</p> <ol><li><p>初始容量为什么要是2的指数次幂
13 -- 16
7 -- 8
hash%length == hash &amp; (length-1) length == 2的指数次幂
加快效率
hashcode 0001 0001 1100 0111
16       0000 0000 0000 1111 (0-15) 保证在数据区间范围内</p></li> <li><p>加载因子为什么不是0.75
如果是定位1,最大化利用空间,但是是不可能的,
如果是0.5,查询效率很高,但是容易扩容,容易占空间</p></li> <li><p>红黑树的长度为什么是8
根据概率统计定律泊松分布,在负载因子在0.75的时候,定位到同一个桶里的概率很小所以此时树化是最佳时机</p></li> <li><p>Jdk1.7 并发出现死环</p></li></ol> <p>解决: 1.8解决
2组指针,高低位 一种高位 一种低位
高位指向头部
低位指向尾部</p> <p>1010 0101 0101 0100
0000 0000 0000 1000</p> <p>存在这两种结果
0000 0000 0000 1000 16 高位指针
0000 0000 0000 0000 0  低位指针</p> <p>低位不动,高位j+长度
没有重新Rehash();链表的长度也减小了</p> <p>能否解决线程安全问题</p> <h1 id="concurrenthashmap"><a href="#concurrenthashmap" class="header-anchor">#</a> ConcurrentHashMap</h1> <blockquote><p>提到ConcurrentHashMap多半是因为HashMap是线程不安全的,这时你可以试着说下HashMap为什么是线程不安全的</p></blockquote> <ol><li>为什要用ConcurrentHashMap</li></ol> <blockquote><p>用ConcurrentHashMap多半是因为HashMap是不安全的,在高并发的情况下存在线程安全问题,上面我们讲到了</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.702528d9.js" defer></script><script src="/assets/js/2.bc0a9366.js" defer></script><script src="/assets/js/8.68952ef1.js" defer></script>
  </body>
</html>
