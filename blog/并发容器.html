<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>blog</title>
    <meta name="description" content="Vuepress blog demo">
    
    
    <link rel="preload" href="/assets/css/0.styles.e12d9437.css" as="style"><link rel="preload" href="/assets/js/app.702528d9.js" as="script"><link rel="preload" href="/assets/js/2.bc0a9366.js" as="script"><link rel="preload" href="/assets/js/14.742193af.js" as="script"><link rel="prefetch" href="/assets/js/10.189532b9.js"><link rel="prefetch" href="/assets/js/11.40dc7aad.js"><link rel="prefetch" href="/assets/js/12.4155dd95.js"><link rel="prefetch" href="/assets/js/13.8a25e8dd.js"><link rel="prefetch" href="/assets/js/15.eb8951e8.js"><link rel="prefetch" href="/assets/js/16.300d77c3.js"><link rel="prefetch" href="/assets/js/17.f9e887bb.js"><link rel="prefetch" href="/assets/js/18.72e5452b.js"><link rel="prefetch" href="/assets/js/19.8eac0218.js"><link rel="prefetch" href="/assets/js/20.698aa3d9.js"><link rel="prefetch" href="/assets/js/21.df54a1e3.js"><link rel="prefetch" href="/assets/js/22.202bc424.js"><link rel="prefetch" href="/assets/js/23.dcdfe1c2.js"><link rel="prefetch" href="/assets/js/24.e5dfe154.js"><link rel="prefetch" href="/assets/js/3.819e11ff.js"><link rel="prefetch" href="/assets/js/4.b2f530cc.js"><link rel="prefetch" href="/assets/js/5.e6bf6ba4.js"><link rel="prefetch" href="/assets/js/6.ddcd92ff.js"><link rel="prefetch" href="/assets/js/7.d7bcaf4d.js"><link rel="prefetch" href="/assets/js/8.68952ef1.js"><link rel="prefetch" href="/assets/js/9.17a8032f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e12d9437.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/FirstBlog.html" class="nav-link">FirstBlog</a></div><div class="nav-item"><a href="/blog/Resume.html" class="nav-link">轻松面试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">MySql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/索引.html" class="nav-link">索引</a></li><li class="dropdown-item"><!----> <a href="/mysql/锁.html" class="nav-link">锁</a></li><li class="dropdown-item"><!----> <a href="/mysql/事务.html" class="nav-link">事务</a></li><li class="dropdown-item"><!----> <a href="/mysql/优化.html" class="nav-link">优化</a></li><li class="dropdown-item"><!----> <a href="/mysql/基础SQL语句.html" class="nav-link">基础SQL语句</a></li><li class="dropdown-item"><!----> <a href="/blog/.html" class="nav-link"></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Spring.html" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">缓存</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Redis.html" class="nav-link">Redis</a></li></ul></div></div> <a href="https://github.com/EternalHao" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/FirstBlog.html" class="nav-link">FirstBlog</a></div><div class="nav-item"><a href="/blog/Resume.html" class="nav-link">轻松面试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">MySql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/索引.html" class="nav-link">索引</a></li><li class="dropdown-item"><!----> <a href="/mysql/锁.html" class="nav-link">锁</a></li><li class="dropdown-item"><!----> <a href="/mysql/事务.html" class="nav-link">事务</a></li><li class="dropdown-item"><!----> <a href="/mysql/优化.html" class="nav-link">优化</a></li><li class="dropdown-item"><!----> <a href="/mysql/基础SQL语句.html" class="nav-link">基础SQL语句</a></li><li class="dropdown-item"><!----> <a href="/blog/.html" class="nav-link"></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Spring.html" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">缓存</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Redis.html" class="nav-link">Redis</a></li></ul></div></div> <a href="https://github.com/EternalHao" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>这块也是面试被问烂的,什么C</p></blockquote> <ol><li>java.util.concurrent.atomic</li> <li>ConcurrentHashMap</li> <li>阻塞队列及特点</li></ol> <h3 id="阻塞队列"><a href="#阻塞队列" class="header-anchor">#</a> 阻塞队列</h3> <blockquote><p>这个队列和我们日常使用到队列不同,它添加了阻塞的概念,阻塞的概念分为两种,
阻塞添加 - 在队列添加的过程中,如果队列的元素已经满了,在后续添加元素的线程就会被阻塞,待到队列不满时,继续唤醒线程继续添加
阻塞删除 - 在队列为空的时候,删除队列元素的线程会被阻塞,直到队列不为空在执行删除操作</p></blockquote> <ol><li>ArrayBlockingQueue</li></ol> <blockquote><p>是一个用数组实现的有界队列,按照先进先出的原则进行排序,ArrayBlockingQueue内部的阻塞队列是通过重入锁ReenterLock和Condition条件队列实现的,通过数组对象items来存储所有的数据,通过两个监视器notNull和NotEmpty实现阻塞,然后通过两个索引实现队列操作.</p></blockquote> <blockquote><p>入队列:
put:  间接调用offer实现
offer: 在开始加锁,判断队列是否已经满,没有满的情况下,加入队列,释放锁
add: 在开始加锁,判断队列是否满,如果已经吗满,运用notFull.await()阻塞当前线程,使线程进入等待队列,直到唤醒为止(队列可以添加元素)</p></blockquote> <blockquote><p>出队列:
poll: 该方法获取并移除此队列的头元素，若队列为空，则返回 null,加锁,出队列,解锁,notFull.signal();
remove:
方法的删除过程相对复杂些，因为该方法并不是直接从队列头部删除元素。首先线程先获取锁，再一步判断队列count&gt;0,这点是保证并发情况下删除操作安全执行。接着获取下一个要添加源的索引putIndex以及takeIndex索引 ，作为后续循环的结束判断，因为只要putIndex与takeIndex不相等就说明队列没有结束。然后通过while循环找到要删除的元素索引，执行removeAt(i)方法删除，在removeAt(i)方法中实际上做了两件事，一是首先判断队列头部元素是否为删除元素，如果是直接删除，并唤醒添加线程，二是如果要删除的元素并不是队列头元素，那么执行循环操作，从要删除元素的索引removeIndex之后的元素都往前移动一个位置，那么要删除的元素就被removeIndex之后的元素替换，从而也就完成了删除操作
take: 有就删除没有就阻塞，注意这个阻塞是可以中断的,如果队列没有数据那么就加入notEmpty条件队列等待,在队列put元素后会唤醒</p></blockquote> <blockquote><p>总结一下, 在添加元素的时候,如果队列已经满 则调用 notFull.await()阻塞线程, 在队列中元素被取走时,会执行     notFull.signal() 唤醒添加线程,在删除元素的时候,如果队列已空,则调用 notEmpty.await()阻塞删除线程,在队列元素添加后,添加线程会 notEmpty.signal() 唤醒删除线程,这是一个典型的生产者和消费者模型</p></blockquote> <ol start="2"><li>LinkedBlockingQueue</li></ol> <blockquote><p>从字面上来看,这是一个由列表实现的有届阻塞队列,但它的大小默认是 Integer.MAX_VALUE,LinkedBlockingQueue时建议手动传值，为其提供我们所需的大小，避免队列过大造成机器负载或者内存爆满等情况</p></blockquote> <blockquote><p>LinkedBlockingQueue是一个基于链表的阻塞队列，其内部维持一个基于链表的数据队列,有两个锁,一个takeLock,一个putLock,一个锁关联一个监视器,takeLock关联notEmpty,putLock关联 notFull,添加和删除操作并不是互斥操作，可以同时进行，这样也就可以大大提高吞吐量</p></blockquote> <p>实现类式上面的额</p> <h3 id="分段锁-concurrenthashmap"><a href="#分段锁-concurrenthashmap" class="header-anchor">#</a> 分段锁 - ConcurrentHashMap</h3> <blockquote><p>说到ConcurrentHashMap,我们不得不提一下HashMap,我们日常经常使用,但是他有个缺点就是不是线程安全的,在多线程的情况下可能会出现环状链表,形成死循环,导致CPU爆掉,为了解决这个问题的,我们想到了HashTable,但是HashTable虽然是安全的,但是效率很慢,他是通过给整个表加锁来实现同步的,在多线程访问时候，只要有一个线程访问或操作该对象，那其他线程只能阻塞，相当于将所有的操作串行化,在竞争激烈的并发场景中性能就会非常差,后来就有了我们的HashMap安全版而且效率也不错--同步版的HashMap</p></blockquote> <p><img src="https://images2015.cnblogs.com/blog/1024555/201705/1024555-20170514174100832-1891630860.png" alt="">
ConcurrentHashMap采用了非常精妙的&quot;分段锁&quot;策略,主干是个Segment数组,首先将数据分成一段一段的存储，然后给每一段数据配一把锁，当一个线程占用锁访问其中一个段数据的时候，其他段的数据也能被其他线程访问</p> <p>ConcurrentHashMap是由Segment数组结构和HashEntry数组结构组成。Segment是一种可重入锁ReentrantLock，在ConcurrentHashMap里扮演锁的角色，HashEntry则用于存储键值对数据。一个ConcurrentHashMap里包含一个Segment数组，Segment的结构和HashMap类似，是一种数组和链表结构， 一个Segment里包含一个HashEntry数组，每个HashEntry是一个链表结构的元素， 每个Segment守护者一个HashEntry数组里的元素,当对HashEntry数组的数据进行修改时，必须首先获得它对应的Segment锁。</p> <p>HashMap ：先说HashMap，HashMap是线程不安全的，在并发环境下，可能会形成环状链表（扩容时可能造成，具体原因自行百度google或查看源码分析），导致get操作时，cpu空转，所以，在并发环境中使用HashMap是非常危险的</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.702528d9.js" defer></script><script src="/assets/js/2.bc0a9366.js" defer></script><script src="/assets/js/14.742193af.js" defer></script>
  </body>
</html>
