<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>blog</title>
    <meta name="description" content="Vuepress blog demo">
    
    
    <link rel="preload" href="/assets/css/0.styles.e12d9437.css" as="style"><link rel="preload" href="/assets/js/app.702528d9.js" as="script"><link rel="preload" href="/assets/js/2.bc0a9366.js" as="script"><link rel="preload" href="/assets/js/23.dcdfe1c2.js" as="script"><link rel="prefetch" href="/assets/js/10.189532b9.js"><link rel="prefetch" href="/assets/js/11.40dc7aad.js"><link rel="prefetch" href="/assets/js/12.4155dd95.js"><link rel="prefetch" href="/assets/js/13.8a25e8dd.js"><link rel="prefetch" href="/assets/js/14.742193af.js"><link rel="prefetch" href="/assets/js/15.eb8951e8.js"><link rel="prefetch" href="/assets/js/16.300d77c3.js"><link rel="prefetch" href="/assets/js/17.f9e887bb.js"><link rel="prefetch" href="/assets/js/18.72e5452b.js"><link rel="prefetch" href="/assets/js/19.8eac0218.js"><link rel="prefetch" href="/assets/js/20.698aa3d9.js"><link rel="prefetch" href="/assets/js/21.df54a1e3.js"><link rel="prefetch" href="/assets/js/22.202bc424.js"><link rel="prefetch" href="/assets/js/24.e5dfe154.js"><link rel="prefetch" href="/assets/js/3.819e11ff.js"><link rel="prefetch" href="/assets/js/4.b2f530cc.js"><link rel="prefetch" href="/assets/js/5.e6bf6ba4.js"><link rel="prefetch" href="/assets/js/6.ddcd92ff.js"><link rel="prefetch" href="/assets/js/7.d7bcaf4d.js"><link rel="prefetch" href="/assets/js/8.68952ef1.js"><link rel="prefetch" href="/assets/js/9.17a8032f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e12d9437.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/FirstBlog.html" class="nav-link">FirstBlog</a></div><div class="nav-item"><a href="/blog/Resume.html" class="nav-link">轻松面试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">MySql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/索引.html" class="nav-link">索引</a></li><li class="dropdown-item"><!----> <a href="/mysql/锁.html" class="nav-link">锁</a></li><li class="dropdown-item"><!----> <a href="/mysql/事务.html" class="nav-link">事务</a></li><li class="dropdown-item"><!----> <a href="/mysql/优化.html" class="nav-link">优化</a></li><li class="dropdown-item"><!----> <a href="/mysql/基础SQL语句.html" class="nav-link">基础SQL语句</a></li><li class="dropdown-item"><!----> <a href="/mysql/.html" class="nav-link"></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Spring.html" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">缓存</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Redis.html" class="nav-link">Redis</a></li></ul></div></div> <a href="https://github.com/EternalHao" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/FirstBlog.html" class="nav-link">FirstBlog</a></div><div class="nav-item"><a href="/blog/Resume.html" class="nav-link">轻松面试</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">MySql</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/索引.html" class="nav-link">索引</a></li><li class="dropdown-item"><!----> <a href="/mysql/锁.html" class="nav-link">锁</a></li><li class="dropdown-item"><!----> <a href="/mysql/事务.html" class="nav-link">事务</a></li><li class="dropdown-item"><!----> <a href="/mysql/优化.html" class="nav-link">优化</a></li><li class="dropdown-item"><!----> <a href="/mysql/基础SQL语句.html" class="nav-link">基础SQL语句</a></li><li class="dropdown-item"><!----> <a href="/mysql/.html" class="nav-link"></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Spring.html" class="nav-link">Spring</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">缓存</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/Redis.html" class="nav-link">Redis</a></li></ul></div></div> <a href="https://github.com/EternalHao" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>这块面试被问到的比较少,准备比较少</p></blockquote> <h3 id="_1-数据库的锁你了解多少"><a href="#_1-数据库的锁你了解多少" class="header-anchor">#</a> 1. 数据库的锁你了解多少</h3> <blockquote><p>锁是数据库系统区分于文件系统的一个关键的特性,锁是用来管理对共享资源的并发访问,而对数据库来说数据就是数据库的资源,对于MyISAM是支持表级锁,而我们用InnoDB则是不支持表级锁,支持行锁,行级锁的特点是开销大,加锁时间长,会出现死锁,锁的粒度最小,发生锁的冲突的概率最低,并发度最高,对于MySql来说,主要有共享锁(读锁)和排他锁(写锁),锁的对象是事务,用来锁定数据库中的对象表、页、行.</p></blockquote> <h3 id="_2-读锁-写锁"><a href="#_2-读锁-写锁" class="header-anchor">#</a> 2. 读锁 写锁</h3> <blockquote><p>共享锁: 也叫读锁,可以让多个事务同时读取一行数据
对于一行数据,不同事务可以同时获取读锁,但是在读取的过程中,其他事务是获取不到这行数据的写锁的,在写入这行数据的时候,在锁没有释放之前,其他事务拿不到该数据的读锁和写锁,对于共享锁大家可能很好理解，就是多个事务只能读数据不能改数据。</p></blockquote> <blockquote><p>排他锁: 也叫写锁,允许各种事务进行删除和修改
当一个线程获得对一个表的写锁后，只有持有锁的线程可以对表进行更新操作。其他线程的读、写操作都会等待，直到锁被释放为止。</p></blockquote> <h3 id="_3-表级锁"><a href="#_3-表级锁" class="header-anchor">#</a> 3. 表级锁</h3> <p>意向共享锁（IS）：事务打算给数据行共享锁，事务在给一个数据行加共享锁前必须先取得该表的IS锁。
意向排他锁（IX）：事务打算给数据行加排他锁，事务在给一个数据行加排他锁前必须先取得该表的IX锁</p> <p>这里为什么要提一下MyISAM就是要浪费时间,如果面试官问你对表级锁有了解吗,你就说我们公司用的是InnoDB(哈哈哈哈)</p> <h3 id="_4-间隙锁"><a href="#_4-间隙锁" class="header-anchor">#</a> 4. 间隙锁</h3> <blockquote><p>当我们用范围条件而不是相等条件检索数据，并请求共享或排他锁时，InnoDB会给符合条件的已有数据记录的 索引项加锁</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">Select</span> <span class="token operator">*</span> <span class="token keyword">from</span>  emp <span class="token keyword">where</span> empid <span class="token operator">&gt;</span> <span class="token number">100</span> <span class="token keyword">for</span> <span class="token keyword">update</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>InnoDB不仅会对符合条件的empid值为101的记录加锁，也会对empid大于101（这些记录并不存在）的“间隙”加锁,
在并发插入大于101 记录的时候,就会出现等待的情况(本不存在数据行被锁)
InnoDB使用间隙锁的目的，一方面是为了防止幻读，以满足相关隔离级别的要求，对于上面的例子，要是不使 用间隙锁，如果其他事务插入了empid大于100的任何记录，那么本事务如果再次执行上述语句，就会发生幻读</p> <h3 id="_4-什么情况下会出现死锁"><a href="#_4-什么情况下会出现死锁" class="header-anchor">#</a> 4. 什么情况下会出现死锁</h3> <p>这个问题还有一个问法就是 如何避免死锁</p> <blockquote><p>1.什么是死锁?</p></blockquote> <blockquote><p>首先说以下什么是死锁,死锁就是两个以上的事务在执行的过程中,由于抢占锁资源而导致的一种相互等待的现象,出现的情况就是
在并发的过程中事务A拿到该记录的读锁在没有释放的情况下去获取该数据行的写锁,而事务B获取了该数据行的写锁,也在没有释放的情况下获取该数据行的读锁,这样就死锁了,解决的办法就是,等待一个事务释放锁,释放锁就需要事务回滚或是事务提交,、</p></blockquote> <blockquote><p>2.如何解决死锁</p></blockquote> <ul><li>尽量使用较低的隔离级别； 精心设计索引，并尽量使用索引访问数据，使加锁更精确，从而减少锁冲突的机会；</li> <li>选择合理的事务大小，小事务发生锁冲突的几率也更小；</li> <li>给记录集显式加锁时，最好一次性请求足够级别的锁。比如要修改数据的话，最好直接申请排他锁，而不是先申请共享锁，修改时再请求排他锁，这样容易产生死锁；</li> <li>不同的程序访问一组表时，应尽量约定以相同的顺序访问各表，对一个表而言，尽可能以固定的顺序存取表中的行。这样可以大大减少死锁的机会；</li> <li>尽量用相等条件访问数据，这样可以避免间隙锁对并发插入的影响;不要申请超过实际需要的锁级别;除非必须，查询时不要显示加锁；</li> <li>对于一些特定的事务，可以使用表锁来提高处理速度或减少死锁的可能</li></ul> <h4 id="https-www-cnblogs-com-leedaily-p-8378779-html"><a href="#https-www-cnblogs-com-leedaily-p-8378779-html" class="header-anchor">#</a> https://www.cnblogs.com/leedaily/p/8378779.html</h4> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>InnoDB行锁是通过给索引上的索引项加锁来实现的，InnoDB这种行锁实现特点意味着：只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁！</p></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.702528d9.js" defer></script><script src="/assets/js/2.bc0a9366.js" defer></script><script src="/assets/js/23.dcdfe1c2.js" defer></script>
  </body>
</html>
